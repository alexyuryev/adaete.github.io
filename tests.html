<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>HTML5 Space Invaders Tests</title>
  <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.4.0.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <canvas id="game-canvas" width="672" height="768">
    Your browser does not support HTML5 canvas.
  </canvas>
  <script src="https://code.jquery.com/qunit/qunit-2.4.0.js"></script>
  <script src="game.js"></script>
  <script>
    QUnit.assert.isUndefined = function (value, message) {
      var result = (value === undefined);
      this.pushResult({
        result:   result,
        actual:   result,
        expected: undefined,
        message:  message
      });
    };
    QUnit.assert.isFalse = function (value, message) {
      this.pushResult({
        result: (value === false),
        actual: value,
        expected: false,
        message: message
      });
    };
    QUnit.assert.isTrue = function (value, message) {
      this.pushResult({
        result: (value === true),
        actual: value,
        expected: true,
        message: message
      });
    };
    // ========================================================================
    // a set of initialization specific unit tests.
    QUnit.module("Initialization tests");
    QUnit.test("Initial state check.", function (assert) {
      var spaceInvaders = new SpaceInvaders.Game();
      var initState = spaceInvaders.isInitialized();
      assert.isFalse(initState, "Init-state should be first false.");
    });
    QUnit.test("Initial state check after initialization.", function (assert) {
      var spaceInvaders = new SpaceInvaders.Game();
      assert.isTrue(spaceInvaders.init(), "Initialization check.");
      var initState = spaceInvaders.isInitialized();
      assert.isTrue(initState, "Init-state should change to true.");
      // TODO check that scene exists.
    });
    QUnit.test("Re-initialization check.", function (assert) {
      var spaceInvaders = new SpaceInvaders.Game();
      assert.isTrue(spaceInvaders.init(), "Initialization check.");
      assert.isFalse(spaceInvaders.init(),"Initialization check.");
      var initState = spaceInvaders.isInitialized();
      assert.isTrue(initState, "Init-state should change to true.");
    });
    QUnit.test("Missing canvas check.", function (assert) {
      // change the identifier of the target canvas temporarily.
      var canvas = document.getElementById("game-canvas");
      canvas.setAttribute("id", "foo-canvas");

      // check that things actually fail.
      var spaceInvaders = new SpaceInvaders.Game();
      assert.isFalse(spaceInvaders.init(), "Initialization fails.");
      var initState = spaceInvaders.isInitialized();
      assert.isFalse(initState, "Init-state should remain false.");

      // restore the original identifier back for the canvas.
      canvas.setAttribute("id", "game-canvas");
    });
    QUnit.test("Missing 2D drawing context check.", function (assert) {
      // disable the context retrieval functionality temporarily.
      var canvas = document.getElementById("game-canvas");
      var originalGetContext = canvas.getContext;
      canvas.getContext = function (value) { return null; }

      // check that things actually fail.
      var spaceInvaders = new SpaceInvaders.Game();
      assert.isFalse(spaceInvaders.init(), "Initialization fails.");
      var initState = spaceInvaders.isInitialized();
      assert.isFalse(initState, "Init-state should remain false.");

      // restore (re-enable) the context retrieval functionality.
      canvas.getContext = originalGetContext;
    });
    // ========================================================================
  </script>
</body>
</html>
